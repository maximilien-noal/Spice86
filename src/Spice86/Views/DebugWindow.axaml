<Window
	x:Class="Spice86.Views.DebugWindow"
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="using:Spice86.ViewModels"
	xmlns:local="clr-namespace:Spice86.Views"
	xmlns:factory="clr-namespace:Spice86.Views.Factory"
	xmlns:fluent="clr-namespace:FluentIcons.Avalonia.Fluent;assembly=FluentIcons.Avalonia.Fluent"
	xmlns:controls="clr-namespace:Spice86.Views.Controls"
	xmlns:views="clr-namespace:Spice86.Views"
	xmlns:dock="clr-namespace:Dock.Avalonia.Controls;assembly=Dock.Avalonia"
	xmlns:dockModel="clr-namespace:Dock.Model.Avalonia.Controls;assembly=Dock.Model.Avalonia"
	xmlns:dockMvvm="clr-namespace:Dock.Model.Mvvm;assembly=Dock.Model.Mvvm"
	x:CompileBindings="True"
	x:DataType="vm:DebugWindowViewModel"
	WindowStartupLocation="CenterOwner"
	ShowInTaskbar="True"
	CanResize="True"
	Title="Spice86 Debug Window"
	MinWidth="1024"
	MinHeight="768"
	Width="1024"
	Height="768"
	Icon="/Views/Assets/Debug.ico"
	mc:Ignorable="d">
	<Window.Resources>
		<FontFamily x:Key="RobotoMonoFont">avares://Spice86/Views/Assets#Roboto Mono</FontFamily>
		<FontFamily x:Key="ConsolasFont">Consolas</FontFamily>
	</Window.Resources>
	<Design.DataContext>
		<vm:DebugWindowViewModel />
	</Design.DataContext>
	<Window.DataTemplates>
		<factory:ViewLocator />
	</Window.DataTemplates>
	<Window.Styles>
		<!-- conflicts with semi theme for the same library, makes the docks headers only visible on mouse hover -->
		<!--<StyleInclude Source="avares://Dock.Avalonia.Themes.Fluent/DockFluentTheme.axaml" />-->
		<StyleInclude Source="avares://Semi.Avalonia.DataGrid/Index.axaml" />
		<StyleInclude Source="avares://Semi.Avalonia.TreeDataGrid/Index.axaml" />
		<StyleInclude Source="avares://AvaloniaHex/Themes/Simple/AvaloniaHex.axaml" />
	</Window.Styles>
	<Grid RowDefinitions="Auto,*,Auto">
		<StackPanel Grid.Row="0" HorizontalAlignment="Center" VerticalAlignment="Top" Orientation="Horizontal">
			<Button
				Margin="5,0,0,0"
				ToolTip.Tip="Pause (Ctrl+Shift+F5)"
				HotKey="Ctrl+Shift+F5"
				Command="{Binding PauseCommand}"
				IsVisible="{Binding !IsPaused}">
				<Button.Content>
					<fluent:SymbolIcon Symbol="Pause" />
				</Button.Content>
			</Button>
			<Button
				Margin="5,0,0,0"
				ToolTip.Tip="Continue (F5)"
				HotKey="F5"
				Command="{Binding ContinueCommand}"
				IsVisible="{Binding IsPaused}">
				<Button.Content>
					<fluent:SymbolIcon Symbol="Play" />
				</Button.Content>
			</Button>
		</StackPanel>
		<dock:DockControl Grid.Row="1" InitializeLayout="True" InitializeFactory="True">
			<dock:DockControl.Factory>
				<dockMvvm:Factory />
			</dock:DockControl.Factory>
			<dockModel:RootDock IsCollapsable="False">
				<dockModel:DocumentDock CanCreateDocument="False">
					<dockModel:Document Id="Disassembly" Title="Disassembly (Alt-F1)" HotKeyManager.HotKey="Alt+F1">
						<TabControl ItemsSource="{Binding $parent[Window].DataContext.DisassemblyViewModels}">
							<TabControl.ItemTemplate>
								<DataTemplate DataType="{x:Type vm:DisassemblyViewModel}">
									<TextBlock Text="{Binding Header}" />
								</DataTemplate>
							</TabControl.ItemTemplate>
							<TabControl.ContentTemplate>
								<DataTemplate DataType="{x:Type vm:DisassemblyViewModel}">
									<ContentPresenter Content="{Binding}" />
								</DataTemplate>
							</TabControl.ContentTemplate>
						</TabControl>
					</dockModel:Document>
					<dockModel:Document 
						Id="CodeFlow" 
						Title="Code Flow (Alt-F2)" 
						HotKeyManager.HotKey="Alt+F2">
						<ContentPresenter
							IsVisible="{Binding $parent[Window].DataContext.CfgCpuViewModel.IsCfgCpuEnabled}"
							Content="{Binding $parent[Window].DataContext.CfgCpuViewModel}" />
					</dockModel:Document>
					<dockModel:Document 
						Id="Cpu" 
						Title="CPU (Alt-F3)" 
						HotKeyManager.HotKey="Alt+F3">
						<ContentPresenter Content="{Binding $parent[Window].DataContext.CpuViewModel}" />
					</dockModel:Document>
					<dockModel:Document Id="Memory" Title="Memory (Alt-F4)" HotKeyManager.HotKey="Alt+F4">
						<TabControl ItemsSource="{Binding $parent[Window].DataContext.MemoryViewModels}">
							<TabControl.ItemTemplate>
								<DataTemplate DataType="{x:Type vm:MemoryViewModel}">
									<TextBlock Text="{Binding Header}" />
								</DataTemplate>
							</TabControl.ItemTemplate>
						</TabControl>
					</dockModel:Document>
					<dockModel:Document 
						Id="Breakpoints" 
						Title="Breakpoints (Alt-F6)" 
						HotKeyManager.HotKey="Alt+F6">
						<ContentPresenter Content="{Binding $parent[Window].DataContext.BreakpointsViewModel}" />
					</dockModel:Document>
					<dockModel:Document Id="OperatingSystem" Title="Operating System">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<TabItem Header="DOS" ToolTip.Tip="DOS Kernel State" Content="{Binding DosViewModel}" />
							<TabItem Header="BIOS" ToolTip.Tip="BIOS Data Area" Content="{Binding BiosViewModel}" />
						</TabControl>
					</dockModel:Document>
					<dockModel:Document Id="Sound" Title="Sound">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<TabItem Header="Sound Blaster" ToolTip.Tip="Sound Blaster Card" Content="{Binding SoundBlasterViewModel}" />
							<TabItem Header="OPL3/FM" ToolTip.Tip="OPL3 FM Synthesizer" Content="{Binding Opl3ViewModel}" />
							<controls:HotKeyTabItem HotKeyManager.HotKey="Alt+F9" Header="General MIDI / MT-32" ToolTip.Tip="Alt-F9" Content="{Binding MidiViewModel}" />
							<controls:HotKeyTabItem HotKeyManager.HotKey="Alt+F10" Header="Software Mixer" ToolTip.Tip="Alt-F10" Content="{Binding SoftwareMixerViewModel}" />
						</TabControl>
					</dockModel:Document>
					<dockModel:Document Id="MemoryManagement" Title="Memory Management">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<TabItem Header="EMS" ToolTip.Tip="Expanded Memory Manager" Content="{Binding EmsViewModel}" />
							<TabItem Header="XMS" ToolTip.Tip="Extended Memory Manager" Content="{Binding XmsViewModel}" />
							<TabItem Header="DMA" ToolTip.Tip="Direct Memory Access" Content="{Binding DmaViewModel}" />
						</TabControl>
					</dockModel:Document>
					<dockModel:Document Id="Hardware" Title="Hardware">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<controls:HotKeyTabItem HotKeyManager.HotKey="Alt+F7" Header="Video Card" ToolTip.Tip="Alt-F7" Content="{Binding VideoCardViewModel}" />
							<controls:HotKeyTabItem HotKeyManager.HotKey="Alt+F8" Header="Color Palette" ToolTip.Tip="Alt-F8" Content="{Binding PaletteViewModel}" />
							<TabItem Header="Timer (PIT)" ToolTip.Tip="Programmable Interval Timer" Content="{Binding TimerViewModel}" />
							<TabItem Header="PIC" ToolTip.Tip="Programmable Interrupt Controller" Content="{Binding PicViewModel}" />
						</TabControl>
					</dockModel:Document>
					<dockModel:Document Id="Debuggers" Title="Debuggers">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<TabItem Header="MCP Server" ToolTip.Tip="Model Context Protocol Server" Content="{Binding McpServerViewModel}" />
							<TabItem Header="GDB Server" ToolTip.Tip="GDB Remote Debug Server" Content="{Binding GdbServerViewModel}" />
						</TabControl>
					</dockModel:Document>
					<dockModel:Document Id="MemoryGraphs" Title="Memory Graphs">
						<TabControl DataContext="{Binding $parent[Window].DataContext}">
							<TabItem Header="MCB Chain" ToolTip.Tip="Memory Control Block Chain Graph">
								<views:McbGraphView DataContext="{Binding McbGraphViewModel}" />
							</TabItem>
							<TabItem Header="PSP Chain" ToolTip.Tip="Program Segment Prefix Chain Graph">
								<views:PspGraphView DataContext="{Binding PspGraphViewModel}" />
							</TabItem>
						</TabControl>
					</dockModel:Document>
				</dockModel:DocumentDock>
			</dockModel:RootDock>
		</dock:DockControl>
		<views:StatusMessageView Grid.Row="2" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" DataContext="{Binding StatusMessageViewModel}" />
	</Grid>
</Window>
